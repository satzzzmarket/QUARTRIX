<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard - QUARTRIX</title>
<link rel="icon" href="https://i.ibb.co.com/7xxVWwH7/IMG-8428.png">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
body{background:#5a3e2b;color:#fff5e6;min-height:100vh;display:flex;flex-direction:column}
header{background:#ff8c42;padding:1.5rem 2rem;display:flex;justify-content:space-between;align-items:center}
header a{color:#fff5e6;text-decoration:none;letter-spacing:2px}
.logout{background:#3e2c23;color:#fff;border:none;padding:10px 18px;border-radius:8px;font-weight:600;cursor:pointer}
main{max-width:1000px;margin:auto;padding:2rem;flex:1}
.card{background:#fff5e6;color:#3e2c23;border-radius:16px;padding:2rem;margin-bottom:2rem;box-shadow:0 10px 25px rgba(0,0,0,.35)}
.card h2{margin-bottom:1rem;color:#5a3e2b}
ul{list-style:none}
li{padding:10px;border-bottom:1px solid #ddd;font-weight:600}

/* JADWAL */
#jadwalButtons{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem}
.hari-btn{background:#ff8c42;color:#fff;border:none;padding:8px 16px;border-radius:8px;font-weight:600;cursor:pointer}
.hari-btn.active{background:#3e2c23}
#jadwalDetail li{border-left:4px solid #ff8c42;padding-left:12px}

/* ADMIN */
#adminPanel input,#tambahTugasPanel input{
  width:100%;padding:10px;margin:.4rem 0;border-radius:8px;border:1px solid #ccc
}
button{cursor:pointer}
footer{text-align:center;padding:1rem;background:#3e2c23}
</style>
</head>

<body>

<header>
  <h1><a href="index.html">QUARTRIX</a></h1>
  <button class="logout" onclick="logout()">Logout</button>
</header>

<main>

<div class="card"><p id="info"></p></div>

<div class="card" id="adminPanel" style="display:none">
  <h2>Tambah Siswa</h2>
  <input id="namaBaru" placeholder="Nama Lengkap">
  <input id="absenBaru" type="number" placeholder="Nomor Absen">
  <button onclick="tambahSiswa()">Tambah</button>
</div>

<div class="card">
  <h2>Jadwal Pelajaran</h2>
  <div id="jadwalButtons"></div>
  <ul id="jadwalDetail"></ul>
</div>

<div class="card">
  <h2>Daftar Tugas</h2>
  <ul id="tugasList"></ul>
  <div id="tambahTugasPanel" style="display:none;margin-top:1rem">
    <input id="tugasBaru" placeholder="Deskripsi tugas">
    <input id="deadlineBaru" type="date">
    <button id="btnTambahTugas" onclick="tambahTugas()">Tambah Tugas</button>
  </div>
</div>

</main>

<footer>&copy; 2025 QUARTRIX</footer>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

  // Config Firebase Anda
  const firebaseConfig = {
    apiKey: "AIzaSyCP-Gha19gZ6ZkYCzZ9vh9QL2tKYmNVoCk",
    authDomain: "quartrix-eb95f.firebaseapp.com",
    databaseURL: "https://quartrix-eb95f-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "quartrix-eb95f",
    storageBucket: "quartrix-eb95f.firebasestorage.app",
    messagingSenderId: "589369640106",
    appId: "1:589369640106:web:7239da0bd98bae284fbcd3",
    measurementId: "G-HG1GL8D03G"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // Login anonymous secara otomatis
  signInAnonymously(auth)
    .then(() => {
      console.log("Anonymous login berhasil");
    })
    .catch((error) => {
      console.error("Error anonymous login:", error);
    });
</script>

<script>
/* LOGIN */
const role = localStorage.getItem("role");
const nama = localStorage.getItem("nama");
const absen = localStorage.getItem("absen");
if(!role) location.href="login.html";

/* INFO */
info.innerText = role==="admin"
  ? "Anda login sebagai ADMIN"
  : `Selamat datang, ${nama} (Absen ${absen})`;

/* ADMIN */
if(role==="admin"){
  adminPanel.style.display="block";
  tambahTugasPanel.style.display="block";
  console.log("Panel admin dan tugas ditampilkan untuk role:", role);
} else {
  console.log("Role bukan admin, panel tidak ditampilkan. Role saat ini:", role);
}

/* SISWA DATA (untuk login, tapi tidak ditampilkan) */
let siswaData = JSON.parse(localStorage.getItem("siswaData")) || [];

/* JADWAL */
const jadwalData = [
 { hari: "Senin", mataPelajaran: "PKWU", waktu: "08:15 - 09:45" },
  { hari: "Senin", mataPelajaran: "Kimia", waktu: "10:15 - 11:40" },
  { hari: "Senin", mataPelajaran: "Matematika Minat", waktu: "12:30 - 13:50" },
  { hari: "Senin", mataPelajaran: "Sejarah", waktu: "13:50 - 15:00" },
  { hari: "Selasa", mataPelajaran: "Bimbingan Konseling", waktu: "07:00 - 07:40" },
  { hari: "Selasa", mataPelajaran: "Matematika Wajib", waktu: "07:40 - 09:00" },
  { hari: "Selasa", mataPelajaran: "Penjaskes", waktu: "09:00 - 11:30" },
  { hari: "Selasa", mataPelajaran: "Fisika", waktu: "12:20 - 13:40" },
  { hari: "Selasa", mataPelajaran: "Bahasa Inggris", waktu: "13:40 - 15:00" },
  { hari: "Rabu", mataPelajaran: "Bahasa Indonesia", waktu: "07:00 - 08:20" },
  { hari: "Rabu", mataPelajaran: "Matematika Minat", waktu: "08:20 - 09:40" },
  { hari: "Rabu", mataPelajaran: "Seni Budaya", waktu: "10:10 - 11:30" },
  { hari: "Rabu", mataPelajaran: "Biologi", waktu: "12:20 - 13:40" },
  { hari: "Rabu", mataPelajaran: "Fisika", waktu: "13:40 - 15:00" },
  { hari: "Kamis", mataPelajaran: "Bahasa Jawa", waktu: "07:00 - 07:40" },
  { hari: "Kamis", mataPelajaran: "Kimia", waktu: "07:40 - 09:40" },
  { hari: "Kamis", mataPelajaran: "Biologi", waktu: "10:10 - 10:50" },
  { hari: "Kamis", mataPelajaran: "Agama", waktu: "12:20 - 13:40" },
  { hari: "Kamis", mataPelajaran: "Bahasa Indonesia", waktu: "13:40 - 15:00" },
  { hari: "Jumat", mataPelajaran: "Matematika Wajib", waktu: "07:00 - 08:30" },
  { hari: "Jumat", mataPelajaran: "BMQ", waktu: "08:30 - 09:15" },
  { hari: "Jumat", mataPelajaran: "PPKn", waktu: "09:45 - 11:15" }

];

const hariList = [...new Set(jadwalData.map(j => j.hari))]; 
// Ambil daftar hari unik: ["Senin", "Selasa", "Rabu", "Kamis", "Jumat"]

hariList.forEach(h => {
  const b = document.createElement("button");
  b.textContent = h;
  b.className = "hari-btn";
  b.onclick = () => tampilJadwal(h, b);
  jadwalButtons.appendChild(b);
});

function tampilJadwal(hari, btn) {
  document.querySelectorAll(".hari-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  jadwalDetail.innerHTML = "";
  jadwalData
    .filter(j => j.hari === hari)
    .forEach(j => {
      const li = document.createElement("li");
      li.textContent = `${j.mataPelajaran} (${j.waktu})`;
      jadwalDetail.appendChild(li);
    });
}

// auto buka hari pertama
tampilJadwal(hariList[0], jadwalButtons.children[0]);


/* TUGAS - Menggunakan Firebase */
let tugasData = [];

function renderTugas(){
  tugasList.innerHTML="";
  tugasData.forEach(t=>{
    const li=document.createElement("li");
    li.textContent=`${t.deskripsi} â€” ${t.deadline}`;
    tugasList.appendChild(li);
  });
}

// Listen untuk perubahan real-time dari Firebase
const tugasRef = ref(db, 'tugas');
onValue(tugasRef, (snapshot) => {
  const data = snapshot.val();
  tugasData = data ? Object.values(data) : [];
  renderTugas();
  console.log("Tugas diperbarui:", tugasData);
});

// Tambahkan event listener untuk tombol
document.getElementById("btnTambahTugas").addEventListener("click", function() {
  console.log("Tombol tambah tugas diklik via event listener");
  tambahTugas();
});

function tambahTugas(){
  console.log("Fungsi tambahTugas dipanggil");
  if(role !== "admin") {
    console.log("Role bukan admin:", role);
    alert("Hanya admin yang bisa menambah tugas!");
    return;
  }
  const desc = tugasBaru.value.trim();
  const dead = deadlineBaru.value;
  if(!desc || !dead) {
    alert("Isi semua field!");
    return;
  }
  const newTugasRef = push(tugasRef);
  set(newTugasRef, {
    deskripsi: desc,
    deadline: dead
  });
  tugasBaru.value="";deadlineBaru.value="";
  alert("Tugas berhasil dipublish kepada semua siswa!");
}

/* TAMBAH SISWA */
function tambahSiswa(){
  const nama = namaBaru.value.trim().toUpperCase();
  const abs = +absenBaru.value;
  if(!nama || !abs) return alert("Isi semua field!");
  siswaData.push({nama, absen: abs});
  namaBaru.value="";absenBaru.value="";
  localStorage.setItem("siswaData",JSON.stringify(siswaData));
  alert("Siswa berhasil ditambahkan!");
}

/* LOGOUT */
function logout(){
  localStorage.clear();
  location.href="login.html";
}
</script>

</body>
</html>
